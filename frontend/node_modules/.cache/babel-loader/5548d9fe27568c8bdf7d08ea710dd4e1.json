{"ast":null,"code":"import _objectSpread from\"/home/herman3g/learn/sourcesage/full-stack-developer-challenge/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _regeneratorRuntime from\"/home/herman3g/learn/sourcesage/full-stack-developer-challenge/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/herman3g/learn/sourcesage/full-stack-developer-challenge/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/herman3g/learn/sourcesage/full-stack-developer-challenge/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useState,useEffect}from\"react\";import\"antd/dist/antd.css\";import{Form,Input,Button,AutoComplete}from\"antd\";import{getImage}from\"../../API-services/images\";import{successModal,errorModal}from\"../../utilities/modal\";import{getProductById,postProduct,updateProduct}from\"../../API-services/product\";var layout={labelCol:{span:2},wrapperCol:{span:8}};var formItemLayout={labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}}};var validateMessages={required:\"${label} is required!\"};var ProductForm=function ProductForm(props){var isMounted=true;var productId=props.match.params.productId;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),autoCompleteOption=_useState2[0],setAutoCompleteOption=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),loading=_useState4[0],setLoading=_useState4[1];var _useState5=useState(\"\"),_useState6=_slicedToArray(_useState5,2),productName=_useState6[0],setProductName=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),imageId=_useState8[0],setImageId=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),description=_useState10[0],setDescription=_useState10[1];var _Form$useForm=Form.useForm(),_Form$useForm2=_slicedToArray(_Form$useForm,1),form=_Form$useForm2[0];var onSubmit=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var payload,response;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setLoading(true);payload={name:productName,logo_id:imageId,description:description};_context.prev=2;response={};if(!productId){_context.next=10;break;}_context.next=7;return updateProduct(productId,payload);case 7:response=_context.sent;_context.next=13;break;case 10:_context.next=12;return postProduct(payload);case 12:response=_context.sent;case 13:if(response.status===200){successModal();}else{errorModal();}_context.next=20;break;case 16:_context.prev=16;_context.t0=_context[\"catch\"](2);errorModal();console.error(_context.t0);case 20:setLoading(false);case 21:case\"end\":return _context.stop();}}},_callee,null,[[2,16]]);}));return function onSubmit(){return _ref.apply(this,arguments);};}();var fetchProduct=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(productId){var response,productData;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.prev=0;_context2.next=3;return getProductById(productId);case 3:response=_context2.sent;productData=response.data.data.product;if(isMounted&&isMounted){setProductName(productData.name);setImageId(productData.logo_id);setDescription(productData.description);form.setFieldsValue({Name:productData.name,ImageUrl:productData.logo.url,Description:productData.description});}_context2.next=11;break;case 8:_context2.prev=8;_context2.t0=_context2[\"catch\"](0);console.error(_context2.t0);case 11:case\"end\":return _context2.stop();}}},_callee2,null,[[0,8]]);}));return function fetchProduct(_x){return _ref2.apply(this,arguments);};}();var fetchImage=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(page,perPage){var response,result;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return getImage(page,perPage);case 3:response=_context3.sent;result=[];if(response.status===200){result=response.data.data.images.map(function(image){return{id:image.id,value:image.url};});if(isMounted){setAutoCompleteOption(result);}}else{console.error(\"fail to fetch images\");}_context3.next=11;break;case 8:_context3.prev=8;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);case 11:case\"end\":return _context3.stop();}}},_callee3,null,[[0,8]]);}));return function fetchImage(_x2,_x3){return _ref3.apply(this,arguments);};}();var onNameChange=function onNameChange(e){setProductName(e.target.value);};var onImageSelect=function onImageSelect(value,optionObject){setImageId(optionObject.id);};var onDescriptionChange=function onDescriptionChange(e){setDescription(e.target.value);};useEffect(function(){fetchImage(1,1000);if(productId){fetchProduct(productId);}return function cleanup(){isMounted=false;};},[]);return/*#__PURE__*/React.createElement(React.Fragment,null,/*#__PURE__*/React.createElement(\"h1\",null,\"Product Form\"),/*#__PURE__*/React.createElement(Form,Object.assign({},formItemLayout,{form:form,name:\"nest-messages\",validateMessages:validateMessages}),/*#__PURE__*/React.createElement(Form.Item,{name:\"Name\",label:\"Name\",rules:[{required:true}]},/*#__PURE__*/React.createElement(Input,{value:productName,onChange:onNameChange,placeholder:\"Insert product name here\"})),/*#__PURE__*/React.createElement(Form.Item,{name:\"ImageUrl\",label:\"Image Url\",rules:[{required:true}]},/*#__PURE__*/React.createElement(AutoComplete,{options:autoCompleteOption,onSelect:onImageSelect,placeholder:\"Image name\",filterOption:function filterOption(inputValue,option){return option.value.toUpperCase().indexOf(inputValue.toUpperCase())!==-1;}})),/*#__PURE__*/React.createElement(Form.Item,{name:\"Description\",label:\"Description\"},/*#__PURE__*/React.createElement(Input.TextArea,{value:description,onChange:onDescriptionChange,placeholder:\"Insert product description here\"})),/*#__PURE__*/React.createElement(Form.Item,{wrapperCol:_objectSpread(_objectSpread({},layout.wrapperCol),{},{offset:8})},/*#__PURE__*/React.createElement(Button,{type:\"primary\",loading:loading,onClick:onSubmit},\"Submit\"))));};export default ProductForm;","map":{"version":3,"sources":["/home/herman3g/learn/sourcesage/full-stack-developer-challenge/frontend/src/pages/Product/Form.jsx"],"names":["React","useState","useEffect","Form","Input","Button","AutoComplete","getImage","successModal","errorModal","getProductById","postProduct","updateProduct","layout","labelCol","span","wrapperCol","formItemLayout","xs","sm","validateMessages","required","ProductForm","props","isMounted","productId","match","params","autoCompleteOption","setAutoCompleteOption","loading","setLoading","productName","setProductName","imageId","setImageId","description","setDescription","useForm","form","onSubmit","payload","name","logo_id","response","status","console","error","fetchProduct","productData","data","product","setFieldsValue","Name","ImageUrl","logo","url","Description","fetchImage","page","perPage","result","images","map","image","id","value","log","onNameChange","e","target","onImageSelect","optionObject","onDescriptionChange","cleanup","inputValue","option","toUpperCase","indexOf","offset"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport \"antd/dist/antd.css\";\nimport { Form, Input, Button, AutoComplete } from \"antd\";\nimport { getImage } from \"../../API-services/images\";\nimport { successModal, errorModal } from \"../../utilities/modal\";\nimport { getProductById, postProduct, updateProduct } from \"../../API-services/product\";\n\nconst layout = {\n  labelCol: {\n    span: 2,\n  },\n  wrapperCol: {\n    span: 8,\n  },\n};\nconst formItemLayout = {\n  labelCol: {\n    xs: { span: 24 },\n    sm: { span: 8 },\n  },\n  wrapperCol: {\n    xs: { span: 24 },\n    sm: { span: 16 },\n  },\n};\n\nconst validateMessages = {\n  required: \"${label} is required!\",\n};\n\nconst ProductForm = (props) => {\n  let isMounted = true\n  let productId = props.match.params.productId\n  let [autoCompleteOption, setAutoCompleteOption] = useState([]);\n  let [loading, setLoading] = useState(false);\n  let [productName, setProductName] = useState(\"\");\n  let [imageId, setImageId] = useState(\"\");\n  let [description, setDescription] = useState(\"\");\n  const [form] = Form.useForm();\n  \n  const onSubmit = async () => {\n    setLoading(true);\n\n    const payload = {\n      name: productName,\n      logo_id: imageId,\n      description,\n    };\n\n    try {\n      let response = {}\n\n      if (productId) {\n        response = await updateProduct(productId, payload);\n      } else {\n        response = await postProduct(payload);\n      }\n\n      if (response.status === 200) {\n        successModal();\n      } else {\n        errorModal();\n      }\n    } catch (error) {\n      errorModal();\n      console.error(error);\n    }\n\n    setLoading(false);\n  };\n\n  const fetchProduct = async (productId) => {\n    try {\n      let response = await getProductById(productId);\n      let productData = response.data.data.product;\n      if (isMounted && isMounted) {\n        setProductName(productData.name)\n        setImageId(productData.logo_id)\n        setDescription(productData.description)\n        form.setFieldsValue({\n          Name: productData.name,\n          ImageUrl: productData.logo.url,\n          Description: productData.description\n        })\n      }\n    } catch (error) {\n      console.error(error);\n    }\n  };\n\n  const fetchImage = async (page, perPage) => {\n    try {\n      let response = await getImage(page, perPage);\n      let result = [];\n      if (response.status === 200) {\n        result = response.data.data.images.map((image) => ({\n          id: image.id,\n          value: image.url,\n        }));\n        if(isMounted) {\n          setAutoCompleteOption(result);\n        }\n      } else {\n        console.error(\"fail to fetch images\");\n      }\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const onNameChange = (e) => {\n    setProductName(e.target.value);\n  };\n\n  const onImageSelect = (value, optionObject) => {\n    setImageId(optionObject.id);\n  };\n\n  const onDescriptionChange = (e) => {\n    setDescription(e.target.value);\n  };\n\n  useEffect(() => {\n    fetchImage(1, 1000);\n    if (productId) {\n      fetchProduct(productId)\n    }\n\n    return function cleanup() {\n      isMounted = false\n    }\n  }, []);\n\n  return (\n    <>\n      <h1>Product Form</h1>\n      <Form\n        {...formItemLayout}\n        form={form}\n        name=\"nest-messages\"\n        validateMessages={validateMessages}\n      >\n        <Form.Item\n          name={\"Name\"}\n          label=\"Name\"\n          rules={[\n            {\n              required: true,\n            },\n          ]}\n        >\n          <Input value={productName} onChange={onNameChange} placeholder={\"Insert product name here\"} />\n        </Form.Item>\n        <Form.Item\n          name={\"ImageUrl\"}\n          label=\"Image Url\"\n          rules={[\n            {\n              required: true,\n            },\n          ]}\n        >\n          <AutoComplete\n            options={autoCompleteOption}\n            onSelect={onImageSelect}\n            placeholder=\"Image name\"\n            filterOption={(inputValue, option) =>\n              option.value.toUpperCase().indexOf(inputValue.toUpperCase()) !==\n              -1\n            }\n          />\n        </Form.Item>\n        <Form.Item name={\"Description\"} label=\"Description\">\n          <Input.TextArea value={description} onChange={onDescriptionChange} placeholder={\"Insert product description here\"}/>\n        </Form.Item>\n        <Form.Item wrapperCol={{ ...layout.wrapperCol, offset: 8 }}>\n          <Button type=\"primary\" loading={loading} onClick={onSubmit}>\n            Submit\n          </Button>\n        </Form.Item>\n      </Form>\n    </>\n  );\n};\n\nexport default ProductForm\n"]},"metadata":{},"sourceType":"module"}